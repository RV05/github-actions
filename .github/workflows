name: Create Tag

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  create-tag:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Determine tag version
        id: determine-tag-version
        run: |
          last_tag=$(git describe --tags --abbrev=0)
          last_version=$(echo $last_tag | cut -dv -f2)
          major=$(echo $last_version | cut -d. -f1)
          minor=$(echo $last_version | cut -d. -f2)
          patch=$(echo $last_version | cut -d. -f3)

          if [[ ${{ github.event.pull_request.body }} == *"major"* ]]; then
            major=$((major + 1))
          elif [[ ${{ github.event.pull_request.body }} == *"minor"* ]]; then
            minor=$((minor + 1))
          fi

          echo "v${major}.${minor}.${patch}"

      - name: Create tag
        run: |
          git config user.name "Your Name"
          git config user.email "youremail@example.com"
          git tag -a ${{ steps.determine-tag-version.outputs.tag_version }} -m "Tag created from pull request"
          git push origin ${{ steps.determine-tag-version.outputs.tag_version }}
